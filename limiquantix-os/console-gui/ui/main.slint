// =============================================================================
// Quantix-OS Console GUI - Main UI Definition
// =============================================================================
// This file defines the complete UI for the Quantix-OS console (DCUI).
// Built with Slint for lightweight, native rendering.
// =============================================================================

import { Button, LineEdit, CheckBox, ComboBox, ProgressIndicator, Spinner } from "std-widgets.slint";

// =============================================================================
// Theme - Dark color scheme optimized for server consoles
// =============================================================================
global Theme {
    // Background layers (dark to light)
    out property <color> bg-dark: #0a0e14;
    out property <color> bg-panel: #141a22;
    out property <color> bg-card: #1a222c;
    out property <color> bg-hover: #242d3a;
    out property <color> bg-selected: #2a3645;
    out property <color> bg-input: #0d1117;
    
    // Text colors
    out property <color> text-primary: #e6edf3;
    out property <color> text-secondary: #8b949e;
    out property <color> text-muted: #6e7681;
    out property <color> text-inverse: #0a0e14;
    
    // Brand colors
    out property <color> accent-blue: #58a6ff;
    out property <color> accent-green: #3fb950;
    out property <color> accent-yellow: #d29922;
    out property <color> accent-red: #f85149;
    out property <color> accent-purple: #a371f7;
    
    // Border colors
    out property <color> border-default: #30363d;
    out property <color> border-hover: #484f58;
    
    // Font sizes
    out property <length> font-xs: 11px;
    out property <length> font-sm: 13px;
    out property <length> font-md: 15px;
    out property <length> font-lg: 18px;
    out property <length> font-xl: 24px;
    out property <length> font-2xl: 32px;
    out property <length> font-3xl: 48px;
    
    // Spacing
    out property <length> spacing-xs: 4px;
    out property <length> spacing-sm: 8px;
    out property <length> spacing-md: 16px;
    out property <length> spacing-lg: 24px;
    out property <length> spacing-xl: 32px;
    
    // Border radius
    out property <length> radius-sm: 4px;
    out property <length> radius-md: 8px;
    out property <length> radius-lg: 12px;
}

// =============================================================================
// Data Structures
// =============================================================================

export struct SystemStatus {
    hostname: string,
    ip-address: string,
    cluster-status: string,
    cpu-percent: float,
    memory-percent: float,
    memory-used: string,
    memory-total: string,
    vm-count: int,
    uptime: string,
    version: string,
    ssh-enabled: bool,
    ssh-sessions: int,
}

export struct LogEntry {
    timestamp: string,
    level: string,
    message: string,
}

export struct NetworkInterface {
    name: string,
    mac: string,
    ip: string,
    status: string,
}

export struct InstallConfig {
    hostname: string,
    admin-username: string,
    admin-password: string,
    confirm-password: string,
    network-interface: string,
    use-dhcp: bool,
    static-ip: string,
    gateway: string,
    dns: string,
    enable-ssh: bool,
}

// =============================================================================
// Reusable Components
// =============================================================================

component StatusDot inherits Rectangle {
    in property <string> status;
    
    width: 8px;
    height: 8px;
    border-radius: 4px;
    background: status == "running" ? Theme.accent-green :
                status == "warning" ? Theme.accent-yellow :
                status == "error" ? Theme.accent-red :
                Theme.text-muted;
}

component ProgressBar inherits Rectangle {
    in property <float> value;
    in property <color> bar-color: Theme.accent-blue;
    
    height: 8px;
    border-radius: 4px;
    background: Theme.bg-input;
    
    Rectangle {
        x: 0;
        y: 0;
        width: parent.width * clamp(value, 0, 1);
        height: parent.height;
        border-radius: parent.border-radius;
        background: bar-color;
    }
}

component Card inherits Rectangle {
    in property <string> title;
    
    background: Theme.bg-card;
    border-radius: Theme.radius-lg;
    border-width: 1px;
    border-color: Theme.border-default;
    
    VerticalLayout {
        padding: Theme.spacing-md;
        spacing: Theme.spacing-sm;
        
        if title != "" : Text {
            text: title;
            font-size: Theme.font-lg;
            font-weight: 600;
            color: Theme.text-primary;
        }
        
        @children
    }
}

component MenuButton inherits Rectangle {
    in property <string> label;
    in property <string> shortcut;
    in property <bool> selected: false;
    
    callback clicked();
    
    height: 44px;
    border-radius: Theme.radius-md;
    background: selected ? Theme.bg-selected : 
                touch.has-hover ? Theme.bg-hover : transparent;
    
    touch := TouchArea {
        clicked => { root.clicked(); }
    }
    
    HorizontalLayout {
        padding-left: Theme.spacing-md;
        padding-right: Theme.spacing-md;
        alignment: space-between;
        
        Text {
            text: label;
            font-size: Theme.font-md;
            color: selected ? Theme.accent-blue : Theme.text-primary;
            vertical-alignment: center;
        }
        
        Text {
            text: shortcut;
            font-size: Theme.font-sm;
            color: Theme.text-muted;
            vertical-alignment: center;
        }
    }
}

component ActionButton inherits Rectangle {
    in property <string> label;
    in property <bool> primary: false;
    in property <bool> danger: false;
    in property <bool> enabled: true;
    
    callback clicked();
    
    height: 40px;
    min-width: 100px;
    border-radius: Theme.radius-md;
    background: !enabled ? Theme.bg-panel :
                danger ? (touch.has-hover ? #dc2626 : Theme.accent-red) :
                primary ? (touch.has-hover ? #2563eb : Theme.accent-blue) :
                touch.has-hover ? Theme.bg-hover : Theme.bg-card;
    border-width: primary || danger ? 0 : 1px;
    border-color: Theme.border-default;
    
    touch := TouchArea {
        enabled: root.enabled;
        clicked => { root.clicked(); }
    }
    
    Text {
        text: label;
        font-size: Theme.font-md;
        font-weight: 500;
        color: primary || danger ? Theme.text-primary : Theme.text-primary;
        horizontal-alignment: center;
        vertical-alignment: center;
    }
}

component InputField inherits Rectangle {
    in property <string> label;
    in property <string> placeholder;
    in property <bool> password: false;
    in-out property <string> value;
    
    callback edited(string);
    
    height: 72px;
    
    VerticalLayout {
        spacing: Theme.spacing-xs;
        
        Text {
            text: label;
            font-size: Theme.font-sm;
            color: Theme.text-secondary;
        }
        
        Rectangle {
            height: 44px;
            border-radius: Theme.radius-md;
            background: Theme.bg-input;
            border-width: 1px;
            border-color: input.has-focus ? Theme.accent-blue : Theme.border-default;
            
            input := TextInput {
                x: Theme.spacing-md;
                width: parent.width - Theme.spacing-md * 2;
                vertical-alignment: center;
                font-size: Theme.font-md;
                color: Theme.text-primary;
                input-type: password ? InputType.password : InputType.text;
                text: value;
                
                edited => {
                    value = self.text;
                    root.edited(self.text);
                }
            }
            
            // Placeholder
            if input.text == "" : Text {
                x: Theme.spacing-md;
                text: placeholder;
                font-size: Theme.font-md;
                color: Theme.text-muted;
                vertical-alignment: center;
            }
        }
    }
}

component Toggle inherits Rectangle {
    in property <string> label;
    in-out property <bool> checked;
    
    callback toggled(bool);
    
    height: 32px;
    
    HorizontalLayout {
        spacing: Theme.spacing-md;
        alignment: start;
        
        Rectangle {
            width: 48px;
            height: 24px;
            border-radius: 12px;
            background: checked ? Theme.accent-blue : Theme.bg-input;
            border-width: 1px;
            border-color: checked ? Theme.accent-blue : Theme.border-default;
            
            touch := TouchArea {
                clicked => {
                    checked = !checked;
                    root.toggled(checked);
                }
            }
            
            Rectangle {
                x: checked ? parent.width - self.width - 2px : 2px;
                y: 2px;
                width: 20px;
                height: 20px;
                border-radius: 10px;
                background: Theme.text-primary;
                
                animate x { duration: 150ms; easing: ease-out; }
            }
        }
        
        Text {
            text: label;
            font-size: Theme.font-md;
            color: Theme.text-primary;
            vertical-alignment: center;
        }
    }
}

component StatRow inherits Rectangle {
    in property <string> label;
    in property <string> value;
    
    height: 28px;
    
    HorizontalLayout {
        alignment: space-between;
        
        Text {
            text: label;
            font-size: Theme.font-sm;
            color: Theme.text-secondary;
            vertical-alignment: center;
        }
        
        Text {
            text: value;
            font-size: Theme.font-sm;
            font-weight: 500;
            color: Theme.text-primary;
            vertical-alignment: center;
        }
    }
}

component LogRow inherits Rectangle {
    in property <LogEntry> entry;
    
    height: 24px;
    
    HorizontalLayout {
        spacing: Theme.spacing-sm;
        
        // Level indicator
        Rectangle {
            width: 6px;
            height: 6px;
            border-radius: 3px;
            background: entry.level == "error" ? Theme.accent-red :
                        entry.level == "warn" ? Theme.accent-yellow :
                        Theme.accent-blue;
            vertical-alignment: center;
        }
        
        Text {
            text: entry.timestamp;
            font-size: Theme.font-xs;
            color: Theme.text-muted;
            vertical-alignment: center;
            min-width: 80px;
        }
        
        Text {
            text: entry.message;
            font-size: Theme.font-xs;
            color: Theme.text-secondary;
            vertical-alignment: center;
            overflow: elide;
        }
    }
}

component InterfaceRow inherits Rectangle {
    in property <NetworkInterface> iface;
    in property <bool> selected: false;
    
    callback clicked();
    
    height: 60px;
    border-radius: Theme.radius-md;
    background: selected ? Theme.bg-selected : 
                touch.has-hover ? Theme.bg-hover : transparent;
    border-width: selected ? 2px : 0;
    border-color: Theme.accent-blue;
    
    touch := TouchArea {
        clicked => { root.clicked(); }
    }
    
    HorizontalLayout {
        padding: Theme.spacing-md;
        spacing: Theme.spacing-md;
        
        VerticalLayout {
            alignment: center;
            spacing: 2px;
            
            HorizontalLayout {
                spacing: Theme.spacing-sm;
                
                StatusDot {
                    status: iface.status == "up" ? "running" : "error";
                }
                
                Text {
                    text: iface.name;
                    font-size: Theme.font-md;
                    font-weight: 600;
                    color: Theme.text-primary;
                }
            }
            
            Text {
                text: iface.mac;
                font-size: Theme.font-xs;
                color: Theme.text-muted;
            }
        }
        
        Rectangle { }
        
        Text {
            text: iface.ip != "" ? iface.ip : "No IP";
            font-size: Theme.font-sm;
            color: iface.ip != "" ? Theme.text-primary : Theme.text-muted;
            vertical-alignment: center;
        }
    }
}

// =============================================================================
// Modal Dialogs
// =============================================================================

component ModalOverlay inherits Rectangle {
    in property <bool> visible: false;
    
    background: #000000aa;
    opacity: visible ? 1 : 0;
    
    animate opacity { duration: 200ms; }
    
    @children
}

component AuthDialog inherits Rectangle {
    in property <bool> visible: false;
    in property <string> title: "Authentication Required";
    in property <string> error-message: "";
    
    out property <string> username;
    out property <string> password;
    
    callback submit(string, string);
    callback cancel();
    
    if visible : ModalOverlay {
        visible: true;
        
        TouchArea {
            clicked => { root.cancel(); }
        }
        
        Rectangle {
            x: (parent.width - self.width) / 2;
            y: (parent.height - self.height) / 2;
            width: 400px;
            height: 320px;
            background: Theme.bg-panel;
            border-radius: Theme.radius-lg;
            border-width: 1px;
            border-color: Theme.border-default;
            
            TouchArea { }
            
            VerticalLayout {
                padding: Theme.spacing-lg;
                spacing: Theme.spacing-md;
                
                Text {
                    text: title;
                    font-size: Theme.font-xl;
                    font-weight: 600;
                    color: Theme.text-primary;
                    horizontal-alignment: center;
                }
                
                InputField {
                    label: "Username";
                    placeholder: "admin";
                    value <=> username;
                }
                
                InputField {
                    label: "Password";
                    placeholder: "Enter password";
                    password: true;
                    value <=> password;
                }
                
                if error-message != "" : Text {
                    text: error-message;
                    font-size: Theme.font-sm;
                    color: Theme.accent-red;
                    horizontal-alignment: center;
                }
                
                HorizontalLayout {
                    spacing: Theme.spacing-md;
                    alignment: center;
                    
                    ActionButton {
                        label: "Cancel";
                        clicked => { root.cancel(); }
                    }
                    
                    ActionButton {
                        label: "Login";
                        primary: true;
                        clicked => { root.submit(username, password); }
                    }
                }
            }
        }
    }
}

component ConfirmDialog inherits Rectangle {
    in property <bool> visible: false;
    in property <string> title: "Confirm Action";
    in property <string> message: "";
    in property <bool> danger: false;
    
    callback confirm();
    callback cancel();
    
    if visible : ModalOverlay {
        visible: true;
        
        TouchArea {
            clicked => { root.cancel(); }
        }
        
        Rectangle {
            x: (parent.width - self.width) / 2;
            y: (parent.height - self.height) / 2;
            width: 400px;
            height: 200px;
            background: Theme.bg-panel;
            border-radius: Theme.radius-lg;
            border-width: 1px;
            border-color: Theme.border-default;
            
            TouchArea { }
            
            VerticalLayout {
                padding: Theme.spacing-lg;
                spacing: Theme.spacing-lg;
                
                Text {
                    text: title;
                    font-size: Theme.font-xl;
                    font-weight: 600;
                    color: danger ? Theme.accent-red : Theme.text-primary;
                    horizontal-alignment: center;
                }
                
                Text {
                    text: message;
                    font-size: Theme.font-md;
                    color: Theme.text-secondary;
                    horizontal-alignment: center;
                    wrap: word-wrap;
                }
                
                HorizontalLayout {
                    spacing: Theme.spacing-md;
                    alignment: center;
                    
                    ActionButton {
                        label: "Cancel";
                        clicked => { root.cancel(); }
                    }
                    
                    ActionButton {
                        label: "Confirm";
                        primary: !danger;
                        danger: danger;
                        clicked => { root.confirm(); }
                    }
                }
            }
        }
    }
}

// =============================================================================
// Installation Wizard
// =============================================================================

component InstallWizard inherits Rectangle {
    in-out property <int> current-step: 1;
    in property <[NetworkInterface]> interfaces;
    in-out property <InstallConfig> config;
    
    callback next-step();
    callback prev-step();
    callback complete(InstallConfig);
    
    background: Theme.bg-dark;
    
    VerticalLayout {
        padding: Theme.spacing-xl;
        spacing: Theme.spacing-xl;
        alignment: center;
        
        // Header
        VerticalLayout {
            spacing: Theme.spacing-sm;
            alignment: center;
            
            Text {
                text: "QUANTIX-OS";
                font-size: Theme.font-3xl;
                font-weight: 700;
                color: Theme.accent-blue;
                horizontal-alignment: center;
            }
            
            Text {
                text: "Installation Wizard";
                font-size: Theme.font-lg;
                color: Theme.text-secondary;
                horizontal-alignment: center;
            }
        }
        
        // Progress indicator
        HorizontalLayout {
            alignment: center;
            spacing: Theme.spacing-md;
            
            for i in [1, 2, 3, 4] : Rectangle {
                width: 40px;
                height: 40px;
                border-radius: 20px;
                background: current-step >= i ? Theme.accent-blue : Theme.bg-card;
                border-width: 2px;
                border-color: current-step >= i ? Theme.accent-blue : Theme.border-default;
                
                Text {
                    text: i;
                    font-size: Theme.font-md;
                    font-weight: 600;
                    color: current-step >= i ? Theme.text-primary : Theme.text-muted;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }
        }
        
        // Step content
        Rectangle {
            width: 500px;
            background: Theme.bg-panel;
            border-radius: Theme.radius-lg;
            border-width: 1px;
            border-color: Theme.border-default;
            
            VerticalLayout {
                padding: Theme.spacing-lg;
                spacing: Theme.spacing-md;
                
                // Step 1: Node Identity
                if current-step == 1 : VerticalLayout {
                    spacing: Theme.spacing-md;
                    
                    Text {
                        text: "Step 1: Node Identity";
                        font-size: Theme.font-xl;
                        font-weight: 600;
                        color: Theme.text-primary;
                    }
                    
                    Text {
                        text: "Enter a hostname for this Quantix-OS node.";
                        font-size: Theme.font-md;
                        color: Theme.text-secondary;
                    }
                    
                    InputField {
                        label: "Hostname";
                        placeholder: "quantix-01";
                        value <=> config.hostname;
                    }
                }
                
                // Step 2: Admin Account
                if current-step == 2 : VerticalLayout {
                    spacing: Theme.spacing-md;
                    
                    Text {
                        text: "Step 2: Admin Account";
                        font-size: Theme.font-xl;
                        font-weight: 600;
                        color: Theme.text-primary;
                    }
                    
                    Text {
                        text: "Create the administrator account for this node.";
                        font-size: Theme.font-md;
                        color: Theme.text-secondary;
                    }
                    
                    InputField {
                        label: "Username";
                        placeholder: "admin";
                        value <=> config.admin-username;
                    }
                    
                    InputField {
                        label: "Password";
                        placeholder: "Enter password";
                        password: true;
                        value <=> config.admin-password;
                    }
                    
                    InputField {
                        label: "Confirm Password";
                        placeholder: "Confirm password";
                        password: true;
                        value <=> config.confirm-password;
                    }
                }
                
                // Step 3: Network Configuration
                if current-step == 3 : VerticalLayout {
                    spacing: Theme.spacing-md;
                    
                    Text {
                        text: "Step 3: Network Configuration";
                        font-size: Theme.font-xl;
                        font-weight: 600;
                        color: Theme.text-primary;
                    }
                    
                    Text {
                        text: "Select the management network interface.";
                        font-size: Theme.font-md;
                        color: Theme.text-secondary;
                    }
                    
                    // Interface list
                    for iface[idx] in interfaces : InterfaceRow {
                        iface: iface;
                        selected: config.network-interface == iface.name;
                        clicked => { config.network-interface = iface.name; }
                    }
                    
                    Toggle {
                        label: "Use DHCP";
                        checked <=> config.use-dhcp;
                    }
                    
                    if !config.use-dhcp : VerticalLayout {
                        spacing: Theme.spacing-sm;
                        
                        InputField {
                            label: "IP Address";
                            placeholder: "192.168.1.100/24";
                            value <=> config.static-ip;
                        }
                        
                        InputField {
                            label: "Gateway";
                            placeholder: "192.168.1.1";
                            value <=> config.gateway;
                        }
                        
                        InputField {
                            label: "DNS Server";
                            placeholder: "8.8.8.8";
                            value <=> config.dns;
                        }
                    }
                }
                
                // Step 4: Security Settings
                if current-step == 4 : VerticalLayout {
                    spacing: Theme.spacing-md;
                    
                    Text {
                        text: "Step 4: Security Settings";
                        font-size: Theme.font-xl;
                        font-weight: 600;
                        color: Theme.text-primary;
                    }
                    
                    Text {
                        text: "Configure security options for this node.";
                        font-size: Theme.font-md;
                        color: Theme.text-secondary;
                    }
                    
                    Toggle {
                        label: "Enable SSH Access";
                        checked <=> config.enable-ssh;
                    }
                    
                    if config.enable-ssh : Text {
                        text: "⚠️ SSH will be enabled. Ensure you use a strong password.";
                        font-size: Theme.font-sm;
                        color: Theme.accent-yellow;
                    }
                    
                    // Summary
                    Rectangle {
                        background: Theme.bg-card;
                        border-radius: Theme.radius-md;
                        
                        VerticalLayout {
                            padding: Theme.spacing-md;
                            spacing: Theme.spacing-sm;
                            
                            Text {
                                text: "Summary";
                                font-size: Theme.font-md;
                                font-weight: 600;
                                color: Theme.text-primary;
                            }
                            
                            StatRow { label: "Hostname"; value: config.hostname; }
                            StatRow { label: "Username"; value: config.admin-username; }
                            StatRow { label: "Network"; value: config.network-interface; }
                            StatRow { label: "DHCP"; value: config.use-dhcp ? "Yes" : "No"; }
                            StatRow { label: "SSH"; value: config.enable-ssh ? "Enabled" : "Disabled"; }
                        }
                    }
                }
            }
        }
        
        // Navigation buttons
        HorizontalLayout {
            alignment: center;
            spacing: Theme.spacing-md;
            
            if current-step > 1 : ActionButton {
                label: "Back";
                clicked => { root.prev-step(); }
            }
            
            if current-step < 4 : ActionButton {
                label: "Next";
                primary: true;
                clicked => { root.next-step(); }
            }
            
            if current-step == 4 : ActionButton {
                label: "Complete Setup";
                primary: true;
                clicked => { root.complete(config); }
            }
        }
    }
}

// =============================================================================
// Main Dashboard
// =============================================================================

component MainScreen inherits Rectangle {
    in property <SystemStatus> status;
    in property <[LogEntry]> logs;
    
    callback menu-action(string);
    
    background: Theme.bg-dark;
    
    HorizontalLayout {
        // Left panel - Status
        Rectangle {
            width: 60%;
            
            VerticalLayout {
                padding: Theme.spacing-lg;
                spacing: Theme.spacing-lg;
                
                // Header
                HorizontalLayout {
                    alignment: space-between;
                    
                    VerticalLayout {
                        spacing: Theme.spacing-xs;
                        
                        Text {
                            text: "QUANTIX-OS";
                            font-size: Theme.font-2xl;
                            font-weight: 700;
                            color: Theme.accent-blue;
                        }
                        
                        Text {
                            text: "v" + status.version;
                            font-size: Theme.font-sm;
                            color: Theme.text-muted;
                        }
                    }
                    
                    // Cluster status badge
                    Rectangle {
                        width: 140px;
                        height: 32px;
                        border-radius: Theme.radius-md;
                        background: status.cluster-status == "Cluster Member" ? 
                                    Theme.accent-green : Theme.bg-card;
                        
                        HorizontalLayout {
                            padding-left: Theme.spacing-sm;
                            padding-right: Theme.spacing-sm;
                            spacing: Theme.spacing-xs;
                            alignment: center;
                            
                            StatusDot {
                                status: status.cluster-status == "Cluster Member" ? 
                                        "running" : "warning";
                            }
                            
                            Text {
                                text: status.cluster-status;
                                font-size: Theme.font-sm;
                                font-weight: 500;
                                color: Theme.text-primary;
                            }
                        }
                    }
                }
                
                // System info card
                Card {
                    title: "System Information";
                    
                    StatRow { label: "Hostname"; value: status.hostname; }
                    StatRow { label: "IP Address"; value: status.ip-address; }
                    StatRow { label: "Uptime"; value: status.uptime; }
                    StatRow { label: "VMs Running"; value: status.vm-count; }
                }
                
                // Resource usage
                Card {
                    title: "Resource Usage";
                    
                    VerticalLayout {
                        spacing: Theme.spacing-md;
                        
                        // CPU
                        VerticalLayout {
                            spacing: Theme.spacing-xs;
                            
                            HorizontalLayout {
                                alignment: space-between;
                                
                                Text {
                                    text: "CPU";
                                    font-size: Theme.font-sm;
                                    color: Theme.text-secondary;
                                }
                                
                                Text {
                                    text: round(status.cpu-percent) + "%";
                                    font-size: Theme.font-sm;
                                    font-weight: 500;
                                    color: Theme.text-primary;
                                }
                            }
                            
                            ProgressBar {
                                value: status.cpu-percent / 100;
                                bar-color: status.cpu-percent > 80 ? Theme.accent-red :
                                          status.cpu-percent > 60 ? Theme.accent-yellow :
                                          Theme.accent-blue;
                            }
                        }
                        
                        // Memory
                        VerticalLayout {
                            spacing: Theme.spacing-xs;
                            
                            HorizontalLayout {
                                alignment: space-between;
                                
                                Text {
                                    text: "Memory";
                                    font-size: Theme.font-sm;
                                    color: Theme.text-secondary;
                                }
                                
                                Text {
                                    text: round(status.memory-percent) + "% (" + 
                                          status.memory-used + " / " + status.memory-total + ")";
                                    font-size: Theme.font-sm;
                                    font-weight: 500;
                                    color: Theme.text-primary;
                                }
                            }
                            
                            ProgressBar {
                                value: status.memory-percent / 100;
                                bar-color: status.memory-percent > 80 ? Theme.accent-red :
                                          status.memory-percent > 60 ? Theme.accent-yellow :
                                          Theme.accent-green;
                            }
                        }
                    }
                }
                
                // SSH Status
                Card {
                    title: "SSH Access";
                    
                    HorizontalLayout {
                        alignment: space-between;
                        
                        HorizontalLayout {
                            spacing: Theme.spacing-sm;
                            
                            StatusDot {
                                status: status.ssh-enabled ? "running" : "error";
                            }
                            
                            Text {
                                text: status.ssh-enabled ? "Enabled" : "Disabled";
                                font-size: Theme.font-md;
                                color: Theme.text-primary;
                                vertical-alignment: center;
                            }
                        }
                        
                        if status.ssh-enabled : Text {
                            text: status.ssh-sessions + " active session(s)";
                            font-size: Theme.font-sm;
                            color: Theme.text-secondary;
                            vertical-alignment: center;
                        }
                    }
                }
                
                // Recent logs
                Card {
                    title: "Recent Activity";
                    
                    for entry in logs : LogRow {
                        entry: entry;
                    }
                }
            }
        }
        
        // Right panel - Menu
        Rectangle {
            width: 40%;
            background: Theme.bg-panel;
            
            VerticalLayout {
                padding: Theme.spacing-lg;
                spacing: Theme.spacing-sm;
                
                Text {
                    text: "Management Menu";
                    font-size: Theme.font-lg;
                    font-weight: 600;
                    color: Theme.text-primary;
                }
                
                Rectangle { height: Theme.spacing-md; }
                
                MenuButton {
                    label: "Configure Network";
                    shortcut: "F2";
                    clicked => { root.menu-action("network"); }
                }
                
                MenuButton {
                    label: "SSH Management";
                    shortcut: "F3";
                    clicked => { root.menu-action("ssh"); }
                }
                
                MenuButton {
                    label: "Join Cluster";
                    shortcut: "F4";
                    clicked => { root.menu-action("cluster"); }
                }
                
                MenuButton {
                    label: "Restart Services";
                    shortcut: "F5";
                    clicked => { root.menu-action("services"); }
                }
                
                MenuButton {
                    label: "View Diagnostics";
                    shortcut: "F7";
                    clicked => { root.menu-action("diagnostics"); }
                }
                
                Rectangle { }
                
                MenuButton {
                    label: "Shutdown / Reboot";
                    shortcut: "F10";
                    clicked => { root.menu-action("power"); }
                }
                
                MenuButton {
                    label: "Emergency Shell";
                    shortcut: "F12";
                    clicked => { root.menu-action("shell"); }
                }
                
                Rectangle { }
                
                // Management URL
                Rectangle {
                    background: Theme.bg-card;
                    border-radius: Theme.radius-md;
                    
                    VerticalLayout {
                        padding: Theme.spacing-md;
                        spacing: Theme.spacing-xs;
                        
                        Text {
                            text: "Management URL";
                            font-size: Theme.font-sm;
                            color: Theme.text-muted;
                        }
                        
                        Text {
                            text: "https://" + status.ip-address + ":8443";
                            font-size: Theme.font-md;
                            font-weight: 500;
                            color: Theme.accent-blue;
                        }
                    }
                }
            }
        }
    }
}

// =============================================================================
// Main Application Window
// =============================================================================

export component AppWindow inherits Window {
    title: "Quantix-OS Console";
    background: Theme.bg-dark;
    
    // Properties
    in property <bool> show-wizard: true;
    in property <int> wizard-step: 1;
    in property <[NetworkInterface]> interfaces;
    in-out property <InstallConfig> install-config;
    in property <SystemStatus> system-status;
    in property <[LogEntry]> log-entries;
    
    // Dialog state
    in property <bool> show-auth-dialog: false;
    in property <string> auth-dialog-title: "Authentication Required";
    in property <string> auth-error: "";
    in property <bool> show-confirm-dialog: false;
    in property <string> confirm-title: "";
    in property <string> confirm-message: "";
    in property <bool> confirm-danger: false;
    
    // Callbacks
    callback wizard-next();
    callback wizard-prev();
    callback wizard-complete(InstallConfig);
    callback menu-action(string);
    callback auth-submit(string, string);
    callback auth-cancel();
    callback confirm-action();
    callback confirm-cancel();
    
    // Main content
    if show-wizard : InstallWizard {
        current-step <=> wizard-step;
        interfaces: interfaces;
        config <=> install-config;
        
        next-step => { root.wizard-next(); }
        prev-step => { root.wizard-prev(); }
        complete(config) => { root.wizard-complete(config); }
    }
    
    if !show-wizard : MainScreen {
        status: system-status;
        logs: log-entries;
        
        menu-action(action) => { root.menu-action(action); }
    }
    
    // Dialogs
    AuthDialog {
        visible: show-auth-dialog;
        title: auth-dialog-title;
        error-message: auth-error;
        
        submit(user, pass) => { root.auth-submit(user, pass); }
        cancel => { root.auth-cancel(); }
    }
    
    ConfirmDialog {
        visible: show-confirm-dialog;
        title: confirm-title;
        message: confirm-message;
        danger: confirm-danger;
        
        confirm => { root.confirm-action(); }
        cancel => { root.confirm-cancel(); }
    }
}
