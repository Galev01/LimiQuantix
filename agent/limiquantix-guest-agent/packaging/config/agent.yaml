# =============================================================================
# Quantix KVM Guest Agent Configuration
# =============================================================================
# This file configures the Quantix KVM Guest Agent running inside the VM.
# Location: /etc/quantix-kvm/agent.yaml (Linux)
#           C:\ProgramData\Quantix-KVM\agent.yaml (Windows)

# -----------------------------------------------------------------------------
# Telemetry Settings
# -----------------------------------------------------------------------------
# Interval in seconds between telemetry reports to the host
telemetry_interval_secs: 5

# -----------------------------------------------------------------------------
# Execution Settings
# -----------------------------------------------------------------------------
# Maximum timeout for command execution (seconds)
max_exec_timeout_secs: 300

# Maximum file chunk size for transfers (bytes)
max_chunk_size: 65536

# -----------------------------------------------------------------------------
# Logging Settings
# -----------------------------------------------------------------------------
# Log level: trace, debug, info, warn, error
log_level: info

# Log format: json or pretty
log_format: json

# Log file path (empty = stdout only)
# Linux: /var/log/quantix-kvm/agent.log
# Windows: C:\ProgramData\Quantix-KVM\Logs\agent.log
log_file: ""

# Maximum log file size before rotation (bytes)
log_max_size_bytes: 10485760  # 10MB

# Number of rotated log files to keep
log_max_files: 5

# -----------------------------------------------------------------------------
# Device Settings
# -----------------------------------------------------------------------------
# Virtio-serial device path (auto = auto-detect)
# Linux: /dev/virtio-ports/org.quantix.agent.0
# Windows: \\.\Global\org.quantix.agent.0
# Note: The virtio-serial port name is kept for backward compatibility
device_path: auto

# -----------------------------------------------------------------------------
# Quiescing Settings (for safe snapshots)
# -----------------------------------------------------------------------------
# Directory containing pre-freeze scripts
pre_freeze_script_dir: /etc/quantix-kvm/pre-freeze.d

# Directory containing post-thaw scripts
post_thaw_script_dir: /etc/quantix-kvm/post-thaw.d

# -----------------------------------------------------------------------------
# Security Settings
# -----------------------------------------------------------------------------
security:
  # Commands that are explicitly allowed (empty = all allowed)
  # Example: ["/usr/bin/systemctl", "/usr/bin/journalctl"]
  command_allowlist: []
  
  # Commands that are explicitly blocked
  # Example: ["/bin/rm", "/sbin/reboot"]
  command_blocklist: []
  
  # Paths where file writes are allowed (empty = all allowed)
  # Example: ["/tmp", "/var/log"]
  allow_file_write_paths: []
  
  # Paths where file reads are denied
  # Example: ["/etc/shadow", "/etc/sudoers"]
  deny_file_read_paths: []
  
  # Maximum commands per minute (0 = unlimited)
  max_commands_per_minute: 0
  
  # Maximum file operations per second (0 = unlimited)
  max_file_ops_per_second: 0
  
  # Enable audit logging for all operations
  audit_logging: false

# -----------------------------------------------------------------------------
# Health Check Settings
# -----------------------------------------------------------------------------
health:
  # Enable internal health monitoring
  enabled: true
  
  # Health check interval in seconds
  interval_secs: 30
  
  # Maximum time without successful telemetry before unhealthy (seconds)
  telemetry_timeout_secs: 60
