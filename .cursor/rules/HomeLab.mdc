---
alwaysApply: true
---

# My Home Lab Infrastructure:

## Hosts

| ID | Role | IP Address | Hardware | Notes |
|----|------|------------|----------|-------|
| QvDC | Quantix-vDC Control Plane | 192.168.0.100 | Dell Latitude 5420 | Runs Control Plane + Dashboard |
| QHCI01 | Quantix-OS Host | 192.168.0.101 | Lenovo ThinkPad Pro | First hypervisor host | 20 CPU | 32 GB RAM
| QHCI02 | Quantix-OS Host | 192.168.0.102 | Lenovo ThinkPad Pro | Second hypervisor host | 20 CPU | 64 GB RAM

## Services

| Service | URL | Port | Description |
|---------|-----|------|-------------|
| **Update Server** | http://192.168.0.148:9000 | 9000 | OTA update server with Admin UI |
| **QvDC Dashboard** | https://192.168.0.100:443 | 443 | vDC web management interface |
| **QvDC API** | http://192.168.0.100:8080 | 8080 | Control plane gRPC/REST API |
| **QHCI01 Host UI** | https://192.168.0.101:8443 | 8443 | Host web management interface |
| **QHCI01 Node API** | https://192.168.0.101:9443 | 9443 | Node daemon gRPC API |

## Database Configuration (QvDC)

The QvDC control plane uses PostgreSQL. **Critical for migrations:**

| Setting | Value |
|---------|-------|
| Host | localhost |
| Port | 5432 |
| Database | `quantix_vdc` |
| User | `postgres` |
| Password | (empty) |
| SSL Mode | disable |
| Config File | `/etc/quantix-vdc/config.yaml` |

### Running Migrations Manually

```bash
# SSH into QvDC
ssh root@192.168.0.100

# Run migration tool (reads config from /etc/quantix-vdc/config.yaml)
cd /usr/share/quantix-vdc/migrations
./quantix-migrate up

# Or run SQL directly
psql -U postgres -d quantix_vdc -f /usr/share/quantix-vdc/migrations/migrations/000012_images_extended.up.sql

# Check migration version
./quantix-migrate version

# View control plane logs
journalctl -u quantix-controlplane -n 100 --no-pager
# Or for OpenRC:
tail -100 /var/log/quantix-controlplane.log
```

## Update Server Quick Reference

The Update Server runs on the QvDC machine and provides OTA updates to all Quantix-OS hosts.

**Start the server:**
```bash
cd update-server
docker-compose up -d
```

**Admin UI:** http://192.168.0.100:9000

**Default credentials:**
- Publish Token: `dev-token` (change in production!)

**Hosts pull updates from:**
- Update Server URL: `http://192.168.0.148:9000`
- Channel: `dev` (development), `beta`, or `stable`

## Troubleshooting

### 500 Errors on ListImages/ListOVATemplates

1. **Check if migration ran:**
   ```bash
   cd /usr/share/quantix-vdc/migrations && ./quantix-migrate version
   ```

2. **Check if images table has correct schema:**
   ```bash
   psql -U postgres -d quantix_vdc -c "\d images"
   ```
   Should have columns: `id`, `name`, `labels`, `format`, `phase`, etc.

3. **Run migration if needed:**
   ```bash
   cd /usr/share/quantix-vdc/migrations && ./quantix-migrate up
   ```

4. **Restart control plane:**
   ```bash
   rc-service quantix-controlplane restart
   ```
