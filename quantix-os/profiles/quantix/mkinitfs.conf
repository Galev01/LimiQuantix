# ============================================================================
# Quantix-OS initramfs Configuration
# ============================================================================
# Features to include in the initramfs for boot
# ============================================================================

# Base features (always needed)
# NOTE: Removed 'kms' feature - GPU drivers should load in userspace, not initramfs
# This prevents boot hangs on some hardware (especially Intel laptops with i915)
features="ata base cdrom ext4 keymap lvm mmc nvme raid scsi squashfs usb virtio xfs"

# Additional modules for virtualization hosts
# These ensure we can boot on any modern hardware

# Kernel modules to include
kernel_modules="
    # Block devices
    ata_piix
    ahci
    nvme
    virtio_blk
    virtio_scsi
    sd_mod
    sr_mod
    
    # USB
    uhci-hcd
    ehci-hcd
    xhci-hcd
    usb-storage
    
    # Filesystems
    squashfs
    overlay
    ext4
    xfs
    vfat
    iso9660
    
    # RAID & LVM
    dm-mod
    dm-crypt
    md-mod
    raid0
    raid1
    raid5
    raid6
    
    # Network (for PXE/iSCSI boot)
    e1000e
    igb
    ixgbe
    i40e
    mlx4_core
    mlx5_core
    virtio_net
    
    # Graphics - DO NOT include GPU drivers in initramfs!
    # GPU drivers (i915, amdgpu, nouveau, vmwgfx) should load in userspace
    # Including them in initramfs causes boot hangs on many systems
    # The qx-console-launcher script loads the appropriate GPU driver later
    
    # Only include basic framebuffer support for early console output
    # These are safe and don't cause hangs
    efifb
    simplefb
"

# Cmdline parameters for squashfs boot
cmdline="ro quiet modloop=/quantix/system.squashfs modules=loop,squashfs,overlay"
