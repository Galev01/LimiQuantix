# =============================================================================
# Quantix Node Daemon Configuration
# =============================================================================
# Location: /etc/limiquantix/node.yaml
# 
# This file configures the Quantix node daemon (qx-node).
# All settings can also be overridden via command-line arguments.
# =============================================================================

# Node identity
node:
  # Node ID (auto-generated if not set)
  # id: "node-1"
  
  # Hostname (auto-detected if not set)
  # hostname: "quantix-host"
  
  # Labels for node selection/affinity
  labels: {}

# Server configuration
server:
  # gRPC server listen address
  listen_address: "0.0.0.0:9090"
  
  # Prometheus metrics port
  metrics_port: 9091
  
  # HTTP/HTTPS server configuration
  http:
    # Enable HTTP server (port 8080) - enabled by default
    enabled: true
    
    # HTTP listen address
    listen_address: "0.0.0.0:8080"
    
    # Path to web UI static files
    webui_path: "/usr/share/quantix-host-ui"
    
    # TLS/HTTPS configuration
    tls:
      # Enable HTTPS server (port 8443) - disabled by default
      # Use --enable-https flag or set to true here
      enabled: false
      
      # HTTPS listen address
      listen_address: "0.0.0.0:8443"
      
      # Enable HTTPâ†’HTTPS redirect from port 80
      # Requires root privileges for port 80
      redirect_http: false
      redirect_port: 80
      
      # TLS certificate paths
      cert_path: "/etc/limiquantix/certs/server.crt"
      key_path: "/etc/limiquantix/certs/server.key"
      
      # Certificate mode: self-signed, manual, or acme
      mode: "self-signed"
      
      # Self-signed certificate settings
      self_signed:
        # Common name (defaults to hostname)
        # common_name: "quantix-host"
        
        # Validity in days
        validity_days: 365
      
      # ACME (Let's Encrypt) settings
      acme:
        enabled: false
        # email: "admin@example.com"
        directory_url: "https://acme-v02.api.letsencrypt.org/directory"
        domains: []
        challenge_type: "http-01"
        account_path: "/etc/limiquantix/certs/acme/account.json"
        auto_renew: true
        renew_before_days: 30

# Hypervisor configuration
hypervisor:
  # Backend: mock, libvirt, or cloud-hypervisor
  backend: "libvirt"
  
  # Libvirt connection URI
  # Use explicit socket path to connect to monolithic libvirtd
  # (Alpine's libvirt tries modular virtqemud first by default)
  libvirt_uri: "qemu+unix:///system?socket=/var/run/libvirt/libvirt-sock"
  
  # VM storage paths
  storage_path: "/var/lib/limiquantix/vms"
  images_path: "/var/lib/limiquantix/cloud-images"

# Control plane configuration (for cluster mode)
control_plane:
  # Control plane address
  address: "http://localhost:8080"
  
  # Enable automatic registration with control plane
  registration_enabled: false
  
  # Heartbeat interval in seconds
  heartbeat_interval_secs: 30

# =============================================================================
# OTA Update Configuration
# =============================================================================
# Enables Over-The-Air updates from the Quantix Update Server.
# This allows updating qx-node, qx-console, and host-ui without burning new ISOs.
#
# See: docs/updates/000081-ota-update-system.md
# =============================================================================

updates:
  # Enable OTA update functionality
  enabled: true
  
  # Update server URL
  # Change this to your update server's IP address
  server_url: "http://192.168.0.251:9000"
  
  # Release channel: dev, beta, or stable
  # - dev: Latest development builds (may be unstable)
  # - beta: Feature-complete testing builds
  # - stable: Production-ready releases
  channel: "dev"
  
  # How often to check for updates (format: "1h", "30m", "1d")
  check_interval: "1h"
  
  # Automatically apply available updates (use with caution!)
  # If false, updates must be manually applied via API or Host UI
  auto_apply: false
  
  # Automatically reboot after A/B system updates
  # Only applies to full system image updates, not component updates
  auto_reboot: false
  
  # Staging directory for downloaded updates
  staging_dir: "/data/updates/staging"
  
  # Backup directory for rollback support
  backup_dir: "/data/updates/backup"
